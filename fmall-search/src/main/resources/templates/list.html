<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="/static/search/css/index.css">
    <link rel="stylesheet" type="text/css" href="/static/search/font/iconfont.css">
    <script src="/static/search/js/jquery-1.12.4.js"></script>
    <title>飞鱼商城</title>
</head>
<body>
<!--头部-->
<div class="header_head">
    <div class="header_head_box">
        <b class="header_head_p">
            <div style="overflow: hidden">
                <a href="http://fmall.com" class="header_head_p_a1" style="width:73px;">
                    飞鱼商城首页
                </a>
            </div>
        </b>
        <ul>
            <li>
                <a th:if="${session.loginUser != null}" class="li_2" style="width: 100px">欢迎：[[${session.loginUser.nickname}]]</a>
                <a th:if="${session.loginUser == null}" href="http://auth.fmall.com/login.html" class="li_2">你好，请登录</a>
            </li>
            <li>
                <a th:if="${session.loginUser == null}" href="http://auth.fmall.com/reg.html">免费注册</a>
            </li>
            <span>|</span>
            <li>
                <a href="http://member.fmall.com/memberOrder.html">我的订单</a>
            </li>
            <span>|</span>
            <li>
                <a href="#">个人中心</a>
            </li>
        </ul>
    </div>
</div>

<!--搜索导航-->
<div class="header_sous">
    <div class="logo">
        <a href="http://fmall.com"><img src="/static/search/./image/logo1.jpg" alt=""></a>
    </div>
    <div class="header_form">
        <input id="keyword_input" type="text" th:value="${param.keyword}"/>
        <a href="javascript:searchByKeyword();">搜索</a>
    </div>
    <div class="header_ico">
        <div class="header_gw">
            <span><a href="http://cart.fmall.com/cart.html">我的购物车</a></span>
            <img src="/static/search/image/settleup-@1x.png"/>
        </div>
    </div>
</div>
<!--手机-->
<div class="JD_ipone">
    <div class="JD_ipone_bar">
        <div class="JD_ipone_one a" th:each="catalog:${result.catalogs}">
            <a th:text="${catalog.catalogName}">手机</a>
        </div>
        <i th:if="${result.navs != null}"><img src="/static/search/image/right-@1x.png" alt=""></i>
        <div class="JD_ipone_one c">
            <!--遍历面包屑功能-->
            <a th:href="${nav.link}" th:each="nav:${result.navs}" style="margin-right: 10px;"><span
                    th:text="${nav.navName}"></span>：<span th:text="${nav.navValue}"></span> ×</a>
        </div>
    </div>

</div>

<!--商品筛选和排序-->
<div class="JD_banner w">
    <div class="JD_nav">
        <div class="JD_selector">
            <div class="JD_nav_logo" th:with="brandId = ${param.brandId}">
                <!--品牌-->
                <div th:if="${#strings.isEmpty(brandId)}" class="JD_nav_wrap">
                    <div class="sl_key">
                        <span><b>品牌：</b></span>
                    </div>
                    <div class="sl_value">
                        <div class="sl_value_logo">
                            <ul>
                                <li th:each="brand:${result.brands}">
                                    <a href="/static/search/#"
                                       th:href="${'javascript:searchProducts(&quot;brandId&quot;,'+brand.brandId+')'}">
                                        <img th:src="${brand.brandImg}" alt="">
                                        <div th:text="${brand.brandName}">
                                            华为(HUAWEI)
                                        </div>
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
                <!--分类-->
                <div class="JD_pre">
                    <div class="sl_key">
                        <span><b>分类：</b></span>
                    </div>
                    <div class="sl_value">
                        <ul>
                            <li th:each="catalog:${result.catalogs}">
                                <a href="/static/search/#"
                                   th:href="${'javascript:searchProducts(&quot;catalog3Id&quot;,'+catalog.catalogId+')'}"
                                   th:text="${catalog.catalogName}"></a>
                            </li>
                        </ul>
                    </div>
                </div>
                <!--其他的所有需要展示的属性-->
                <div class="JD_pre" th:each="attr:${result.attrs}"
                     th:if="${!#lists.contains(result.attrIds,attr.attrId)}">
                    <div class="sl_key">
                        <span th:text="${attr.attrName}">屏幕尺寸：</span>
                    </div>
                    <div class="sl_value">
                        <ul>
                            <li th:each="val:${attr.attrValue}">
                                <a href="/static/search/#"
                                   th:href="${'javascript:searchProducts(&quot;attrs&quot;,&quot;'+attr.attrId+'_'+val+'&quot;)'}"
                                   th:text="${val}">5.56英寸及以上</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <!--排序-->
        <div class="JD_banner_main" style="margin-bottom: 40px">
            <!--综合排序-->
            <div class="JD_con_right">
                <div class="filter">
                    <!--综合排序-->
                    <div class="filter_top">
                        <!--th:with定义一个变量-->
                        <div class="filter_top_left" th:with="p = ${param.sort},priceRange = ${param.skuPrice}">
                            <a
                                    th:class="${(!#strings.isEmpty(p) && #strings.startsWith(p,'hotScore') && #strings.endsWith(p,'desc'))?'sort_a desc':'sort_a'}"
                                    th:attr="style = ${(#strings.isEmpty(p)|| #strings.startsWith(p,'hotScore'))?'color:#FFF;border-color:#e4393c;background:#e4393c;':'color:#333;border-color:#CCC;background:#FFF;'}"
                                    sort="hotScore" href="/static/search/#">综合排序 [[${(!#strings.isEmpty(p) &&
                                #strings.startsWith(p,'hotScore') && #strings.endsWith(p,'desc')) ? '↓' : '↑'}]]</a>
                            <a th:class="${(!#strings.isEmpty(p) &&#strings.startsWith(p,'saleCount') && #strings.endsWith(p,'desc'))?'sort_a desc':'sort_a'}"
                               th:attr="style = ${(!#strings.isEmpty(p)&& #strings.startsWith(p,'saleCount'))?'color:#FFF;border-color:#e4393c;background:#e4393c;':'color:#333;border-color:#CCC;background:#FFF;'}"
                               sort="saleCount" href="/static/search/#">销量 [[${(!#strings.isEmpty(p)
                                &&#strings.startsWith(p,'saleCount') && #strings.endsWith(p,'desc'))?'↓':'↑'}]]</a>
                            <a th:class="${(!#strings.isEmpty(p) &&#strings.startsWith(p,'skuPrice') && #strings.endsWith(p,'desc'))?'sort_a desc':'sort_a'}"
                               th:attr="style = ${(!#strings.isEmpty(p)&& #strings.startsWith(p,'skuPrice'))?'color:#FFF;border-color:#e4393c;background:#e4393c;':'color:#333;border-color:#CCC;background:#FFF;'}"
                               sort="skuPrice" href="/static/search/#">价格 [[${(!#strings.isEmpty(p)
                                &&#strings.startsWith(p,'skuPrice') && #strings.endsWith(p,'desc'))?'↓':'↑'}]]</a>
                            <input id="skuPriceFrom" type="number" style="width: 100px;margin-left: 30px;"
                                   th:value="${#strings.isEmpty(priceRange)?'': #strings.substringBefore(priceRange,'_')}">
                            -
                            <input id="skuPriceTo" type="number" style="width: 100px;"
                                   th:value="${#strings.isEmpty(priceRange)?'': #strings.substringAfter(priceRange,'_')}">
                            <button id="skuPriceSearchBtn">确定</button>
                        </div>
                    </div>
                    <!--收货地址-->
                    <div class="filter_bottom">
                        <div class="filter_bottom_right">
                            <ul>
                                <li>
                                    <a th:with="check = ${param.hasStock}">
                                        <input id="showHashStock" type="checkbox"
                                               th:checked="${#strings.equals(check,'1')}">
                                        仅显示有货
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <!--排序内容-->
                    <div class="rig_tab">
                        <div th:each="product:${result.getProducts()}">
                            <p class="da">
                                <!--themeleaf中用 | | 包含字符串-->
                                <a href="http://item.fmall.com/1.html"
                                   th:href="|http://item.fmall.com/${product.skuId}.html|">
                                    <img th:src="${product.skuImg}" class="dim">
                                </a>
                            </p>
                            <ul class="tab_im">
                                <li><a href="/static/search/#" title="黑色">
                                    <img th:src="${product.skuImg}">
                                </a></li>
                            </ul>
                            <p class="tab_R">
                                <span th:text="'￥'+${product.skuPrice}">¥5199.00</span>
                            </p>
                            <p class="tab_JE">
                                <a href="/static/search/#" th:utext="${product.skuTitle}">
                                    Apple iPhone 7 Plus (A1661) 32G 黑色 移动联通电信4G手机
                                </a>
                            </p>
                            <div class="tab_FO">
                                <div class="FO_one">
                                    <p>自营
                                        <span>飞鱼商城自营,品质保证</span>
                                    </p>
                                    <p>满赠
                                        <span>该商品参加满赠活动</span>
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!--分页-->
                    <div class="filter_page">
                        <div class="page_wrap">
                            <span class="page_span1">
                                <a class="page_a" th:attr="pn=${result.pageNum - 1}" th:if="${result.pageNum > 1}">
                                    < 上一页
                                </a>
                                <a class="page_a"
                                   th:attr="pn=${nav},style=${nav == result.pageNum ? 'border: 0;color:#ee2222;background: #fff' : ''}"
                                   th:each="nav:${result.pageNavs}">[[${nav}]]</a>

                                <a class="page_a" th:attr="pn=${result.pageNum + 1}"
                                   th:if="${result.pageNum < result.totalPages}">
                                    下一页 >
                                </a>
                            </span>
                            <span class="page_span2">
                                <em>共<b>[[${result.totalPages}]]</b>页&nbsp;&nbsp;到第</em>
                                <input type="number" value="1">
                                <em>页</em>
                                <a class="page_submit">确定</a>
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!--右侧侧边栏-->
<div class="header_bar">
    <div class="header_bar_box">
        <ul>
            <li>
                <a href="/static/search/#"><img src="/static/search/img/wo.png"/></a>
                <div class="div">
                    <a href="#">个人中心</a>
                </div>
            </li>
            <li>
                <a href="/static/search/#"><img src="/static/search/img/gouwuche.png"/></a>
                <div class="div">
                    <a href="http://cart.fmall.com/cart.html">购物车</a>
                </div>
            </li>
        </ul>
    </div>
</div>

<script>
    $(".sl_ext a:nth-child(1)").hover(function () {
        $(this).children("b").stop(true).animate({top: "3px"}, 50);
        $(this).children("i").stop(true).animate({top: "-23px"}, 50)
    }, function () {
        $(this).children("b").stop(true).animate({top: "24px"}, 50);
        $(this).children("i").stop(true).animate({top: "3px"}, 50)
    });
    $(".sl_ext a:nth-child(2)").hover(function () {
        $(this).children("span").stop(true).animate({top: "-1px"}, 100);
        $(this).children("i").stop(true).animate({top: "-14px"}, 100).css({display: "none"})
    }, function () {
        $(this).children("span").stop(true).animate({top: "14px"}, 100);
        $(this).children("i").stop(true).animate({top: "-1px"}, 100).css({display: "block"})
    });
    $('.tab_im img').hover(function () {
        var a = $(this).prop('src');
        var index = $(this).parents('li').index();
        $(this).parents('li').css('border', '2px solid red').siblings('li').css('border', '1px solid #ccc');
        $(this).parents('ul').prev().find('img').prop('src', a);
        $(this).parents('ul').siblings('.tab_JE').find('a').eq(index).css('display', 'block').siblings('a').css('display', 'none');
        $(this).parents('ul').siblings('.tab_R').find('span').eq(index).css('display', 'block').siblings('span').css('display', 'none')
    });

    $(".JD_ipone_one").hover(function () {
        $(this).children("div").css({display: "block"})
    }, function () {
        $(this).children("div").css({display: "none"})
    });

    $("#tab>li").click(function () {
        var i = $(this).index();
        $("#container>div").hide().eq(i).show()
    });
    $(".dizhi_show").hover(function () {
        $(".dizhi_con").css({display: "block"})
    }, function () {
        $(".dizhi_con").css({display: "none"})
    });
    $(".dizhi_con").hover(function () {
        $(this).css({display: "block"})
    }, function () {
        $(this).css({display: "none"})
    });
    //显示隐藏
    var $li = $(".JD_nav_logo>div:gt(3)").hide();
    $('.JD_show span').click(function () {
        if ($li.is(':hidden')) {
            $li.show();
            $(this).css({width: "86px"}).text('收起 ^');
        } else {
            $li.hide();
            $('.JD_show span').css({width: "291px"}).text('更多选项（ CPU核数、网络、机身颜色 等）');
        }
        return false;
    });


    $(".rig_tab>div").hover(function () {
        var i = $(this).index();
        $(this).find('.ico').css({display: 'block'}).stop(true).animate({top: "190px"}, 300)
    }, function () {
        var i = $(this).index();
        $(this).find('.ico').css({display: 'none'}).stop(true).animate({top: "230px"})
    });

    $('.header_main_left>ul>li').hover(function () {
        $(this).css({
            background: "#f0f0f0"
        }).find('.header_main_left_main').stop(true).fadeIn(300)
    }, function () {
        $(this).css({
            background: "#fff"
        }).find(".header_main_left_a").css({
            color: "#000"
        });
        $(this).find('.header_main_left_main').stop(true).fadeOut(100)
    });
    $(".header_sj a").hover(function () {
        $(this).css({
            background: "#444"
        })
    }, function () {
        $(this).css({
            background: "#6e6568"
        })
    });


    $(".nav_li1 a").hover(function () {
        $(".header_main_left").stop(true).fadeIn()
    }, function () {
        $(".header_main_left").stop(true).fadeOut()
    });
    $(".header_main_left").hover(function () {
        $(this).stop(true).fadeIn()
    }, function () {
        $(this).stop(true).fadeOut()
    });


    //右侧侧边栏
    $(".header_bar_box ul li").hover(function () {
        $(this).css({
            background: "#7A6E6E"
        }).children(".div").css({
            display: "block"
        }).stop(true).animate({
            left: "-60px"
        }, 300)
    }, function () {
        $(this).css({
            background: "#7A6E6E"
        }).children(".div").css({
            display: "none"
        }).stop(true).animate({
            left: "0"
        }, 300)
    });


    //底部
    $(".footer_foot .p1 a").hover(function () {
        $(this).css("color", "#D70B1C")
    }, function () {
        $(this).css("color", "#727272")
    });

    $(".footer .footer_center ol li a").hover(function () {
        $(this).css("color", "#D70B1C")
    }, function () {
        $(this).css("color", "#727272")
    })

    function searchProducts(name, value) {
        //设置到第一页
        var href = location.href + "";
        href = repalceAndAddParamVal(href, "pageNum", 1,false);
        //原来的页面
        location.href = repalceAndAddParamVal(href, name, value, false);
    }

    function searchByKeyword() {
        searchProducts("keyword", $("#keyword_input").val());
    }

    $(".page_a").click(function () {
        var pn = $(this).attr("pn");
        var href = location.href + "";
        if (href.indexOf("pageNum") != -1) {
            location.href = repalceAndAddParamVal(href, "pageNum", pn,false);
        } else {
            location.href = location.href + "&pageNum=" + pn;
        }
        return false;
    })

    function repalceAndAddParamVal(url, paramName, replaceVal, forceAdd) {
        //1.如果没有就添加，有就替换
        var oUrl = url.toString();
        if (oUrl.indexOf(paramName) != -1) {
            if (forceAdd) {
                var nUrl = "";
                if (oUrl.indexOf("?") != -1) {
                    nUrl = oUrl + "&" + paramName + "=" + replaceVal;
                } else {
                    nUrl = oUrl + "?" + paramName + "=" + replaceVal;
                }
                return nUrl;
            } else {
                var re = eval('/(' + paramName + '=)([^&]*)/gi');
                var nUrl = oUrl.replace(re, paramName + "=" + replaceVal);
                return nUrl;
            }
        } else {
            var nUrl = "";
            if (oUrl.indexOf("?") != -1) {
                nUrl = oUrl + "&" + paramName + "=" + replaceVal;
            } else {
                nUrl = oUrl + "?" + paramName + "=" + replaceVal;
            }
            return nUrl;
        }
    }

    $(".sort_a").click(function () {
        //1.当前被点击的元素变成选中状态
        //changeStyle(this);
        //2.跳转到指定位置
        $(this).toggleClass("desc");//加上就是降序，不加就是升序
        var sort = $(this).attr('sort');
        sort += $(this).hasClass("desc") ? "_desc" : "_asc";
        location.href = repalceAndAddParamVal(location.href, "sort", sort);
        return false;
    });
    $("#skuPriceSearchBtn").click(function () {
        //1.拼上价格区间
        var from = $("#skuPriceFrom").val();
        var to = $("#skuPriceTo").val();
        var query = from + "_" + to;
        //设置到第一页
        var href = location.href + "";
        href = repalceAndAddParamVal(href, "pageNum", 1,false);
        if (query != "_") {
           location.href = repalceAndAddParamVal(href, "skuPrice", query,false);
        } else {
            //设置为空
            var re = eval('/(&skuPrice=)([^&]*)/gi');
           location.href = (href + "").replace(re, '');
        }
    });
    $("#showHashStock").change(function () {
        if ($(this).prop("checked")) {
            location.href = repalceAndAddParamVal(location.href, "hasStock", 1);
        } else {
            //没选中
            var re = eval('/(&hasStock=)([^&]*)/gi');
            location.href = (location.href + "").replace(re, '');
        }
        return false;
    });
</script>
</body>
</html>